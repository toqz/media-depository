/**
 * AngularJS factory for restful.
 * @version v0.0.3 - 2013-06-07
 * @link https://esdrasedu.github.io/angular-restful
 * @author Esdras Eduardo <esdrasedu@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function RouteRestfulProvider(){this.$get=["$http","$parse",function(a,b){function c(a){return d(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function d(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function e(a,b){this.template=a+="#",this.defaults=b||{},this.urlParams={}}var f=(angular.noop,angular.forEach);return angular.extend,angular.copy,angular.isFunction,angular.isArray,e.prototype={getUrl:function(a,b){var d,e,g=this,h=b||g.template,i=g.urlParams={};return f(h.split(/\W/),function(a){a&&new RegExp("(^|[^\\\\]):"+a+"(\\W|$)").test(h)&&(i[a]=!0)}),h=h.replace(/\\:/g,":"),a=a||{},f(g.urlParams,function(b,f){d=a.hasOwnProperty(f)?a[f]:g.defaults[f],angular.isDefined(d)&&null!==d?(e=c(d),h=h.replace(new RegExp(":"+f+"(\\W|$)","g"),e+"$1")):h=h.replace(new RegExp("(/?):"+f+"(\\W|$)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),h.replace(/\/?#$/,"").replace(/\/*$/,"")},getParams:function(a,b){var d,e,g=this,h=b||g.template,i=g.urlParams={};f(h.split(/\W/),function(a){a&&new RegExp("(^|[^\\\\]):"+a+"(\\W|$)").test(h)&&(i[a]=!0)}),h=h.replace(/\\:/g,":"),a=a||{},f(g.urlParams,function(b,f){d=a.hasOwnProperty(f)?a[f]:g.defaults[f],angular.isDefined(d)&&null!==d?(e=c(d),h=h.replace(new RegExp(":"+f+"(\\W|$)","g"),e+"$1")):h=h.replace(new RegExp("(/?):"+f+"(\\W|$)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})});var j;return f(a,function(a,b){g.urlParams[b]||(j=j||{},j[b]=a)}),j}},e}]}function RestfulProvider(){var a={get:{method:"GET"},query:{method:"GET",isArray:!0},create:{method:"POST"},update:{method:"PUT"},destroy:{method:"DELETE"}},b="";this.actions=function(b){return a=angular.extend({},a,b),this},this.url=function(a){return b=a,this},this.$get=["$http","$parse","$routeRestful",function(c,d,e){function f(d,n){function o(a,b){var c={};return b=i({},n.params,b),h(b,function(b,d){k(b)&&(b=b()),c[d]=b.charAt&&"@"==b.charAt(0)?m(a,b.substr(1)):b}),c}function p(a){j(a||{},this),this.$getUrl=function(){return s.getUrl(this)}}var q={params:{},actions:{},baseURL:null,only:null,except:null};if(n=angular.extend({},q,n),actions=angular.extend({},a,n.actions),l(n.only)){var r={};h(actions,function(a,b){n.only.has(b)&&(r[b]=a)}),actions=r}else if(l(n.except)){var r={};h(actions,function(a,b){n.except.has(b)||(r[b]=a)}),actions=r}var s=new e(d);return h(actions,function(a,d){a.method=angular.uppercase(a.method);var e="POST"==a.method||"PUT"==a.method||"PATCH"==a.method;p[d]=function(d,f,m,q,r){function t(){B.$resolved=!0}var u,v,w={},x=[],y=g,z=null,A=n.baseURL||b;switch(arguments.length){case 5:z=r;case 4:y=q;case 3:k(m)?k(f)?(y=f,z=m):y=m:x=m;case 2:k(f)?k(d)?z=f:y=f:l(f)?x=f:u=f;case 1:k(d)?y=d:l(d)?x=d:e&&!u?u=d:w=d;break;case 0:break;default:throw"Expected between 0-5 arguments [params, data, resources, success, error], got "+arguments.length+" arguments."}var v,B=this instanceof p?this:a.isArray?[]:new p(u),C={};h(a,function(a,b){"params"!=b&&"isArray"!=b&&(C[b]=j(a))}),C.data=u;var D=i({},o(u,a.params||{}),w);return C.url="",h(x,function(a){a.hasOwnProperty("$getUrl")&&(C.url=C.url+a.$getUrl())}),C.url=A+C.url+s.getUrl(D,a.url),C.params=s.getParams(D,a.url),C.headers||(C.headers={Accept:"application/json","Content-Type":"application/json"}),v=c(C),B.$resolved=!1,v.then(t,t),B.$then=v.then(function(b){var c=b.data,d=B.$then,e=B.$resolved;return c&&(a.isArray?(B.length=0,h(c,function(a){var b=new p(a);b.$resources=x,B.push(b)})):(j(c,B),B.$then=d,B.$resolved=e,B.$resources=x,B.$getUrl=function(){return s.getUrl(c)})),(y||g)(B,b.headers),b.restful=B,b},z).then,B},p.prototype["$"+d]=function(a,b,c,f){var h,i=o(this),j=this.$resources,m=g;switch(arguments.length){case 4:h=f;case 3:m=f;case 2:k(b)?k(a)?(m=a,h=b):m=b:j=b;case 1:k(a)?m=a:l(a)?j=a:i=a;break;case 0:break;default:throw"Expected between 0-4 arguments [params, resources, success, error], got "+arguments.length+" arguments."}var n=e?this:void 0;p[d].call(this,i,n,j,m,h)}}),p.bind=function(a){return f(d,i({},n,a))},p}var g=angular.noop,h=angular.forEach,i=angular.extend,j=angular.copy,k=angular.isFunction,l=angular.isArray,m=function(a,b){return d(b)(a)};return Array.prototype.hasOwnProperty("has")||Object.defineProperty(Array.prototype,"has",{value:function(a){var b=!1;if(this.length)for(var c=0;c<this.length;c++)if(this[c]==a){b=!0;break}return b}}),f}]}angular.module("restful",["ng"]).provider("$routeRestful",RouteRestfulProvider).provider("$restful",RestfulProvider);